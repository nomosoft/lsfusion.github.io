<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="lsfusion documentation Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="lsfusion documentation Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="lsfusion documentation" href="/opensearch.xml"><title data-react-helmet="true">How-to: Registers | lsfusion documentation</title><meta data-react-helmet="true" property="og:url" content="https://lsfusion.github.io/next/How-to_Registers/"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="How-to: Registers | lsfusion documentation"><meta data-react-helmet="true" name="description" content="Accumulation ledger"><meta data-react-helmet="true" property="og:description" content="Accumulation ledger"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://lsfusion.github.io/next/How-to_Registers/"><link data-react-helmet="true" rel="alternate" href="https://lsfusion.github.io/next/How-to_Registers/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://lsfusion.github.io/ru/next/How-to_Registers/" hreflang="ru"><link data-react-helmet="true" rel="alternate" href="https://lsfusion.github.io/next/How-to_Registers/" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.2da82c91.css">
<link rel="preload" href="/assets/js/runtime~main.6b4d425c.js" as="script">
<link rel="preload" href="/assets/js/main.2ca2f8a6.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title"></b></a><a class="navbar__item navbar__link" href="/next/Install/">Install</a><a class="navbar__item navbar__link navbar__link--active" href="/next/">Learn</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/lsfusion/platform" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link" href="/next/">5 (Next)</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/next/How-to_Registers/">5 (Next)</a></li><li><a class="dropdown__link" href="/How-to_Registers/">4.x</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/next/How-to_Registers/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">English</a></li><li><a href="/ru/next/How-to_Registers/" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">–†—É—Å—Å–∫–∏–π</a></li></ul></div><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">üåú</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">üåû</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/next/">Overview</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#">Paradigm</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/next/Paradigm/">Overview</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Logical model</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Physical model</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#">Language</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/next/Language/">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/next/Tokens/">Tokens</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/next/IDs/">IDs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/next/Literals/">Literals</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Statements</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/next/Coding_conventions/">Coding conventions</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/next/IDE/">IDE</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Examples</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/next/Examples/">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/next/Score_table/">Score table</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/next/Materials_management/">Materials management</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">How-to</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/next/How-to/">Overview</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">How-to: Computations</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">How-to: GUI</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">How-to: Imperative logic</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">How-to: Declarative logic</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">How-to: Searching for elements</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">How-to: Extensions</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">How-to: Integration</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">How-to: Use Cases</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/next/How-to_Use_Cases/">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/next/How-to_Working_with_documents/">How-to: Working with documents</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/next/How-to_Registers/">How-to: Registers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/next/How-to_Numbering/">How-to: Numbering</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/next/How-to_Using_objects_as_templates/">How-to: Using objects as templates</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/next/How-to_Overriding_values/">How-to: Overriding values</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/next/How-to_Binding_properties/">How-to: Binding properties</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/next/How-to_Metaprogramming/">How-to: Metaprogramming</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/next/How-to_Physical_model/">How-to: Physical model</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/next/How-to_Internationalization/">How-to: Internationalization</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/next/Online_demo/">Online demo</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for lsfusion documentation <b>5 (Next)</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/How-to_Registers/">latest version</a></b> (4.x).</div></div><div class="docItemContainer_33ec"><article><span class="badge badge--secondary">Version: 5 (Next)</span><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">How-to: Registers</h1></header><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="accumulation-ledger"></a>Accumulation ledger<a class="hash-link" href="#accumulation-ledger" title="Direct link to heading">#</a></h3><p>Let&#x27;s assume we need to implement the logic for calculating the SKU balances.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly lsf"><pre tabindex="0" class="prism-code language-lsf codeBlock_23N8 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#403f53"><span class="token plain">REQUIRE Utils;</span></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#403f53"><span class="token plain">CLASS SKU &#x27;SKU&#x27;;</span></span><span class="token-line" style="color:#403f53"><span class="token plain">CLASS Stock &#x27;Warehouse&#x27;;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Theoretically we could just create a <a href="/next/Properties/">property</a> that would sum up all incomings and subtract all outgoings, with all operations set explicitly. The weakness of this approach is that whenever a new operation is added, it needs to be added to the formula for calculating the balance. In addition, it will be difficult to build a form with a list of all the operations that can affect the balance for a specific SKU and warehouse. <a href="/next/Modularity/">Modularity</a> will also be violated, because the module in which the balance property is declared will depend on all modules containing operations that affect it.</p><p>To give the system efficient <a href="/next/Extensions/">extensibility</a>, it is best to implement this kind of functionality using <em>ledgers</em>. To do this, we introduce an abstract class <code>SKULedger</code>. One instance of the class will reflect a single change in the balance by a given amount (positive or negative) for one SKU in one warehouse. Abstract properties are set for it, which need to be defined when the class is implemented.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>All ledgers can have an arbitrary number and type of measurements. In this example they are the SKU and the Warehouse.</p></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly lsf"><pre tabindex="0" class="prism-code language-lsf codeBlock_23N8 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#403f53"><span class="token plain">CLASS ABSTRACT SKULedger &#x27;Register of changes in the product balance&#x27;;</span></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#403f53"><span class="token plain">posted &#x27;Completed&#x27; = ABSTRACT BOOLEAN (SKULedger);</span></span><span class="token-line" style="color:#403f53"><span class="token plain">dateTime &#x27;Date/time&#x27; = ABSTRACT DATETIME (SKULedger);</span></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#403f53"><span class="token plain">sku &#x27;SKU&#x27; = ABSTRACT SKU (SKULedger);</span></span><span class="token-line" style="color:#403f53"><span class="token plain">stock &#x27;Warehouse&#x27; = ABSTRACT Stock (SKULedger);</span></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#403f53"><span class="token plain">quantity &#x27;Qty&#x27; = ABSTRACT NUMERIC[14,2] (SKULedger);</span></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#403f53"><span class="token plain">balance &#x27;Balance&#x27; = GROUP SUM quantity(SKULedger l) IF posted(l) BY stock(l), sku(l);</span></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#403f53"><span class="token plain">balance &#x27;Balance as of date/time&#x27; = GROUP SUM quantity(SKULedger l) IF posted(l) AND dateTime(l) &lt;= DATETIME dt BY stock(l), sku(l), dateTime(l);</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The current balance and the balance for a certain time period are calculated only from the properties of the <code>SKULedger</code> class without reference to specific operations. This code can and must be declared in a separate module. Modules containing specific operations will use and extend this class.</p><p>For example, let&#x27;s look at one operation: <em>Stock receipt</em>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly lsf"><pre tabindex="0" class="prism-code language-lsf codeBlock_23N8 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#403f53"><span class="token plain">CLASS Receipt &#x27;Warehouse arrival&#x27;;</span></span><span class="token-line" style="color:#403f53"><span class="token plain">posted &#x27;Completed&#x27; = DATA BOOLEAN (Receipt);</span></span><span class="token-line" style="color:#403f53"><span class="token plain">dateTime &#x27;Date/time&#x27; = DATA DATETIME (Receipt);</span></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#403f53"><span class="token plain">stock &#x27;Warehouse&#x27; = DATA Stock (Receipt);</span></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#403f53"><span class="token plain">CLASS ReceiptDetail &#x27;Warehouse arrival line&#x27;;</span></span><span class="token-line" style="color:#403f53"><span class="token plain">receipt &#x27;Arrival&#x27; = DATA Receipt (ReceiptDetail) NONULL DELETE;</span></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#403f53"><span class="token plain">sku &#x27;SKU&#x27; = DATA SKU (ReceiptDetail);</span></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#403f53"><span class="token plain">quantity &#x27;Qty&#x27; = DATA NUMERIC[14,2] (ReceiptDetail);</span></span><span class="token-line" style="color:#403f53"><span class="token plain">price &#x27;Price&#x27; = DATA NUMERIC[14,2] (ReceiptDetail);</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>To &quot;post&quot; it into the ledger, we need to <a href="/next/Class_extension/">extend the class</a> <code>SKULedger</code> with a <code>ReceiptDetail</code> class for stock receipt. We also need to <a href="/next/Property_extension/">extend the properties</a> of the ledger.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly lsf"><pre tabindex="0" class="prism-code language-lsf codeBlock_23N8 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#403f53"><span class="token plain">EXTEND CLASS ReceiptDetail : SKULedger;</span></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#403f53"><span class="token plain">// [SKULedger] must be specified, since ReceiptDetail also inherits PriceLedger in the same example and the platform needs to know which property needs to be implemented</span></span><span class="token-line" style="color:#403f53"><span class="token plain">posted[SKULedger](ReceiptDetail d) += posted(receipt(d));</span></span><span class="token-line" style="color:#403f53"><span class="token plain">dateTime[SKULedger](ReceiptDetail d) += dateTime(receipt(d));</span></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#403f53"><span class="token plain">stock[SKULedger](ReceiptDetail d) += stock(receipt(d));</span></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#403f53"><span class="token plain">sku[SKULedger](ReceiptDetail d) += sku(d);</span></span><span class="token-line" style="color:#403f53"><span class="token plain">quantity[SKULedger](ReceiptDetail d) += quantity(d);</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Let&#x27;s look at a more complex case, when we have a document recording transfer from one warehouse to another.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly lsf"><pre tabindex="0" class="prism-code language-lsf codeBlock_23N8 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#403f53"><span class="token plain">CLASS Transfer &#x27;Moving from warehouse to warehouse&#x27;;</span></span><span class="token-line" style="color:#403f53"><span class="token plain">posted &#x27;Completed&#x27; = DATA BOOLEAN (Transfer);</span></span><span class="token-line" style="color:#403f53"><span class="token plain">dateTime &#x27;Date/time&#x27; = DATA DATETIME (Transfer);</span></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#403f53"><span class="token plain">fromStock &#x27;Warehouse (from)&#x27; = DATA Stock (Transfer);</span></span><span class="token-line" style="color:#403f53"><span class="token plain">toStock &#x27;Warehouse (to)&#x27; = DATA Stock (Transfer);</span></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#403f53"><span class="token plain">CLASS TransferDetail &#x27;Warehouse shipment line&#x27;;</span></span><span class="token-line" style="color:#403f53"><span class="token plain">transfer &#x27;Arrival&#x27; = DATA Transfer (TransferDetail) NONULL DELETE;</span></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#403f53"><span class="token plain">sku &#x27;SKU&#x27; = DATA SKU (TransferDetail);</span></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#403f53"><span class="token plain">quantity &#x27;Qty&#x27; = DATA NUMERIC[14,2] (TransferDetail);</span></span><span class="token-line" style="color:#403f53"><span class="token plain">price &#x27;Price&#x27; = DATA NUMERIC[14,2] (TransferDetail);</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In this case, the data from the document must be &quot;posted&quot; into the ledger twice. By analogy with stock receipt, we will post the line into the ledger as an outgoing operation with a negative value.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly lsf"><pre tabindex="0" class="prism-code language-lsf codeBlock_23N8 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#403f53"><span class="token plain">EXTEND CLASS TransferDetail : SKULedger;</span></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#403f53"><span class="token plain">posted(TransferDetail d) += posted(transfer(d));</span></span><span class="token-line" style="color:#403f53"><span class="token plain">dateTime(TransferDetail d) += dateTime(transfer(d));</span></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#403f53"><span class="token plain">stock(TransferDetail d) += fromStock(transfer(d));</span></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#403f53"><span class="token plain">sku(TransferDetail d) += sku(d);</span></span><span class="token-line" style="color:#403f53"><span class="token plain">quantity(TransferDetail d) += -quantity(d);</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>To post it into the ledger for the warehouse where the SKUs are being transferred to, we use object <a href="/next/Aggregations/">aggregation</a>. The line in the transfer document will generate an object, which in turn will be &quot;posted&quot; into the ledger.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly lsf"><pre tabindex="0" class="prism-code language-lsf codeBlock_23N8 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#403f53"><span class="token plain">CLASS TransferSKULedger &#x27;Moving to warehouse (register)&#x27; : SKULedger;</span></span><span class="token-line" style="color:#403f53"><span class="token plain">transferSKULedger = AGGR TransferSKULedger WHERE posted(TransferDetail transferDetail);</span></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#403f53"><span class="token plain">posted(TransferSKULedger d) += d IS TransferSKULedger;</span></span><span class="token-line" style="color:#403f53"><span class="token plain">dateTime(TransferSKULedger d) += dateTime(transfer(transferDetail(d)));</span></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#403f53"><span class="token plain">stock(TransferSKULedger d) += toStock(transfer(transferDetail(d)));</span></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#403f53"><span class="token plain">sku(TransferSKULedger d) += sku(transferDetail(d));</span></span><span class="token-line" style="color:#403f53"><span class="token plain">quantity(TransferSKULedger d) += quantity(transferDetail(d));</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The ledger object will only be created when the transfer document has been posted. Therefore, in this case the <code>posted</code> property will always equal <code>TRUE</code>.</p><p>It should be noted that documents with one warehouse can also be posted into the ledger using aggregation. The aggregation scheme is more flexible but requires the creation of additional objects in the system, which may be worse from a performance perspective.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="information-ledger"></a>Information ledger<a class="hash-link" href="#information-ledger" title="Direct link to heading">#</a></h3><p>The <em>information ledger</em> technique makes it possible to implement the logic of changing a certain indicator over time in a flexible way. Unlike the inventory ledger, it calculates not the sum of an indicator but its latest value over a certain period of time.</p><p>To implement this technique we introduce an abstract class <code>PriceLedger</code>. Its instance reflects a single price change for one SKU and one warehouse at a certain time.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly lsf"><pre tabindex="0" class="prism-code language-lsf codeBlock_23N8 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#403f53"><span class="token plain">CLASS ABSTRACT PriceLedger &#x27;Receipt price change register&#x27;;</span></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#403f53"><span class="token plain">posted &#x27;Completed&#x27; = ABSTRACT BOOLEAN (PriceLedger);</span></span><span class="token-line" style="color:#403f53"><span class="token plain">dateTime &#x27;Date/time&#x27; = ABSTRACT DATETIME (PriceLedger);</span></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#403f53"><span class="token plain">sku &#x27;SKU&#x27; = ABSTRACT SKU (PriceLedger);</span></span><span class="token-line" style="color:#403f53"><span class="token plain">stock &#x27;Warehouse&#x27; = ABSTRACT Stock (PriceLedger);</span></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#403f53"><span class="token plain">price &#x27;Price&#x27; = ABSTRACT NUMERIC[14,2] (PriceLedger);</span></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#403f53"><span class="token plain">price &#x27;Price&#x27; (Stock stock, SKU sku, DATETIME dateTime) =</span></span><span class="token-line" style="color:#403f53"><span class="token plain">    GROUP LAST price(PriceLedger l)</span></span><span class="token-line" style="color:#403f53"><span class="token plain">          ORDER dateTime(l), l</span></span><span class="token-line" style="color:#403f53"><span class="token plain">          WHERE posted(l) AND dateTime(l) &lt;= dateTime</span></span><span class="token-line" style="color:#403f53"><span class="token plain">          BY stock(l), sku(l);</span></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#403f53"><span class="token plain">price &#x27;Price&#x27; (Stock stock, SKU sku) =</span></span><span class="token-line" style="color:#403f53"><span class="token plain">    GROUP LAST price(PriceLedger l)</span></span><span class="token-line" style="color:#403f53"><span class="token plain">          ORDER dateTime(l), l</span></span><span class="token-line" style="color:#403f53"><span class="token plain">          WHERE posted(l)</span></span><span class="token-line" style="color:#403f53"><span class="token plain">          BY stock(l), sku(l);</span></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#403f53"><span class="token plain">price &#x27;Price&#x27; (SKU sku, DATETIME dateTime) =</span></span><span class="token-line" style="color:#403f53"><span class="token plain">    GROUP LAST price(PriceLedger l)</span></span><span class="token-line" style="color:#403f53"><span class="token plain">          ORDER dateTime(l), l</span></span><span class="token-line" style="color:#403f53"><span class="token plain">          WHERE posted(l) AND dateTime(l) &lt;= dateTime</span></span><span class="token-line" style="color:#403f53"><span class="token plain">          BY sku(l);</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>As a result, we get properties giving the price by SKU and warehouse for the date/time, the latest price, and also the latest price for that SKU for all warehouses.</p><p>Documents are posted into the information ledger the same way they are posted into the inventory ledger.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly lsf"><pre tabindex="0" class="prism-code language-lsf codeBlock_23N8 thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#403f53"><span class="token plain">EXTEND CLASS ReceiptDetail : PriceLedger;</span></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#403f53"><span class="token plain">// [PriceLedger] must be specified, since ReceiptDetail also inherits SKULedger in the same example and the platform needs to know which property to implement</span></span><span class="token-line" style="color:#403f53"><span class="token plain">posted[PriceLedger](ReceiptDetail d) += posted(receipt(d));</span></span><span class="token-line" style="color:#403f53"><span class="token plain">dateTime[PriceLedger](ReceiptDetail d) += dateTime(receipt(d));</span></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#403f53"><span class="token plain">stock[PriceLedger](ReceiptDetail d) += stock(receipt(d));</span></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#403f53"><span class="token plain">sku[PriceLedger](ReceiptDetail d) += sku(d);</span></span><span class="token-line" style="color:#403f53"><span class="token plain">price[PriceLedger](ReceiptDetail d) += price(d);</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In this case the signature of the abstract property needs to be specified explicitly, because there can be several of them with the same name and namespace (properties are named in just the same way for class <code>SKULedger</code>).</p></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/lsfusion/platform/edit/master/docs/en/How-to_Registers.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF">Last updated on <b><time datetime="2021-05-26T15:17:28.000Z">5/26/2021</time></b></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/next/How-to_Working_with_documents/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ How-to: Working with documents</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/next/How-to_Numbering/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">How-to: Numbering ¬ª</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#accumulation-ledger" class="table-of-contents__link">Accumulation ledger</a></li><li><a href="#information-ledger" class="table-of-contents__link">Information ledger</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/">lsf docs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://ru.stackoverflow.com/questions/tagged/lsfusion" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://slack.lsfusion.org" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/lsfusion" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog/">Blog</a></li><li class="footer__item"><a href="https://habr.com/ru/company/lsfusion/blog/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Habr<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/lsfusion/platform" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2021 lsFusion Foundation. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.6b4d425c.js"></script>
<script src="/assets/js/main.2ca2f8a6.js"></script>
</body>
</html>